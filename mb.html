<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Long-Term Monthly Budget Manager</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
Â  :root{
Â  Â  /* Color Palette Refined */
Â  Â  --green:#10b981;
Â  Â  --red:#ef4444;
Â  Â  --gray:#f9fafb; /* Lighter background for a cleaner look */
Â  Â  --light-gray:#f3f4f6; /* Used for category rows */
Â  Â  --dark:#1f2937; /* Slightly softer dark text */
Â  Â  --primary:#4f46e5; /* Deep Indigo */
Â  Â  --secondary: #9333ea; /* Purple for utility */
Â  Â  --shadow-sm: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
Â  Â  --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
Â  Â  --radius: 0.6rem;
Â  }
Â  /* Used Inter font for a modern, clean look */
Â  body{font-family:'Inter', system-ui, sans-serif; margin:0; background:var(--gray); color:var(--dark);}Â 
Â  h1{text-align:center; margin:.8em 0 .4em; font-size:1.8rem; font-weight: 800;}
Â  .container{padding:1rem; max-width:1200px; margin:auto;}Â 
Â  
Â  /* --- Control Row Styling --- */
Â  .year-row{
Â  Â  display:flex;
Â  Â  gap:.75rem;
Â  Â  justify-content:center;
Â  Â  margin-bottom:1.5rem;
Â  Â  flex-wrap: wrap;
Â  }
Â  .year-row button, .year-row select {
Â  Â  color:#fff;
Â  Â  border:none;
Â  Â  padding:.6rem 1.2rem; /* Increased padding */
Â  Â  border-radius:var(--radius);
Â  Â  cursor:pointer;
Â  Â  font-size:1rem;
Â  Â  font-weight: 600;
Â  Â  transition: all .2s ease; /* Smoother transitions */
Â  Â  box-shadow: var(--shadow-sm); /* Added subtle shadow */
Â  Â  outline: none;
Â  }
Â  /* Primary (Navigation) */
Â  .year-row button:not(#exportBtn):not(#importBtn):not(#clearBtn), .year-row select {
Â  Â  background:var(--primary);
Â  }
Â  .year-row button:not(#exportBtn):not(#importBtn):not(#clearBtn):hover, .year-row select:hover {
Â  Â  background:#4338ca;
Â  Â  box-shadow: var(--shadow-md);
Â  Â  transform: translateY(-1px);
Â  }
Â  /* Secondary (Utility) */
Â  #exportBtn, #importBtn { background: var(--secondary); }
Â  #exportBtn:hover, #importBtn:hover { background: #7e22ce; box-shadow: var(--shadow-md); transform: translateY(-1px); }
Â  /* Danger/Warning (Clear) */
Â  #clearBtn { background: var(--red); }
Â  #clearBtn:hover { background: #c52929; box-shadow: var(--shadow-md); transform: translateY(-1px); }

Â  /* --- Table Styling --- */
Â  .table-wrapper{
Â  Â  overflow-x:auto; 
Â  Â  background:#fff; 
Â  Â  box-shadow:var(--shadow-md); /* Stronger table shadow */
Â  Â  border-radius:var(--radius);
Â  }
Â  table{width:100%;border-collapse:separate; border-spacing: 0;} /* Use separate borders for rounded look */
Â  
Â  /* Table Header */
Â  th{
Â  Â  background:var(--primary);
Â  Â  color:#fff;
Â  Â  position:sticky;
Â  Â  top:0;
Â  Â  z-index:2;
Â  Â  font-weight: 700;
Â  }
Â  /* Rounded corners for the header */
Â  .table-wrapper table th:first-child { border-top-left-radius: var(--radius); }
Â  .table-wrapper table th:last-child { border-top-right-radius: var(--radius); }

Â  /* Cells */
Â  th,td{
Â  Â  padding:.7rem .55rem; /* Increased padding for spaciousness */
Â  Â  font-size:.9rem;
Â  Â  text-align:right;
Â  Â  border:1px solid #e5e7eb;
Â  Â  min-width:80px; 
Â  Â  white-space:nowrap;
Â  }Â 
Â  
Â  /* Input Fields */
Â  td input{
Â  Â  width:100%;
Â  Â  border:none;
Â  Â  text-align:right;
Â  Â  font-size:.9rem;
Â  Â  padding:.25rem 0;
Â  Â  background:transparent;
Â  Â  transition: outline .15s;
Â  }
Â  td input:focus{
Â  Â  outline:2px solid var(--primary);
Â  Â  border-radius: 4px;
Â  }
Â  
Â  /* Row Types */
Â  .cat td{
Â  Â  background:var(--light-gray); /* Lighter background for category */
Â  Â  font-weight:700;
Â  Â  text-align:left;
Â  }Â 
Â  .total td{
Â  Â  font-weight:700; 
Â  Â  background:#eef2ff; /* Light primary color for total rows */
Â  }
Â  .net td{
Â  Â  font-weight:800; /* Extra bold */
Â  Â  background:#f0fdf4; /* Very light green/blue for net */
Â  }Â 
Â  .net-pos{color:var(--green)}
Â  .net-neg{color:var(--red)}
Â  .col-label{text-align:left !important;}

Â  @media(min-width:700px){
Â  Â  th,td,input{font-size:1rem;padding:.8rem .65rem}
Â  }
</style>
</head>
<body>

<div class="container">Â 
Â  <h1>ðŸ“Š Monthly Budget & Net-Profit Tracker</h1>

Â  <div class="year-row">
Â  Â  <button id="prevBtn" title="Previous Year">â€¹ Prev Year</button>
Â  Â  <select id="yearSel"></select>
Â  Â  <button id="nextBtn" title="Next Year">Next Year â€º</button>
Â  Â  <button id="exportBtn" title="Download current year data">Export CSV</button>
Â  Â  <button id="importBtn" title="Upload CSV data">Import CSV</button>
Â  Â  <button id="clearBtn" title="Clear ALL data for the current year (irreversible)">Clear Year</button>
Â  Â  <input type="file" id="importFile" accept=".csv" hidden />
Â  </div>
    
Â  <div class="table-wrapper">
Â  Â  <table id="budgetTable">
Â  Â  Â  <thead>
Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  <th class="col-label">Category / Line</th>
Â  Â  Â  Â  Â  <th>Jan</th><th>Feb</th><th>Mar</th><th>Apr</th><th>May</th><th>Jun</th>
Â  Â  Â  Â  Â  <th>Jul</th><th>Aug</th><th>Sep</th><th>Oct</th><th>Nov</th><th>Dec</th>
Â  Â  Â  Â  Â  <th>Year Total</th>
Â  Â  Â  Â  </tr>
Â  Â  Â  </thead>
Â  Â  Â  <tbody></tbody>
Â  Â  </table>
Â  </div>
</div>

<script>
/* ---------- CONFIGURATION ---------- */
const MONTHS=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
const ROWS=[
Â  {id:'inc_cat',type:'cat',name:'INCOME'},
Â  {id:'inc_job',type:'item',name:'Primary Job (Net)'},
Â  {id:'inc_side',type:'item',name:'Side Hustle'},
Â  {id:'inc_total',type:'total',name:'TOTAL INCOME',totalOf:['inc_job','inc_side']},

Â  {id:'exp_cat',type:'cat',name:'EXPENSES'},
Â  {id:'exp_rent',type:'item',name:'Rent / Mortgage'},
Â  {id:'exp_loan',type:'item',name:'Loan Payments'},
Â  {id:'exp_groceries',type:'item',name:'Groceries'},
Â  {id:'exp_utilities',type:'item',name:'Utilities'},
Â  {id:'exp_total',type:'total',name:'TOTAL EXPENSES',totalOf:['exp_rent','exp_loan','exp_groceries','exp_utilities']},

Â  {id:'net',type:'net',name:'NET PROFIT / (LOSS)',netOf:['inc_total','exp_total']}
];

const STORAGE_KEY='budgetDataV2';
// Currency Formatter for clean display
const FORMATTER = new Intl.NumberFormat('en-US', {
Â  Â  style: 'currency',
Â  Â  currency: 'USD',
Â  Â  minimumFractionDigits: 2,
});

/* ---------- STATE & DOM ACCESS ---------- */
let currentYear=new Date().getFullYear();
let db=loadAll();

const tbody=document.querySelector('#budgetTable tbody');
const yearSel=document.getElementById('yearSel');
const prevBtn=document.getElementById('prevBtn');
const nextBtn=document.getElementById('nextBtn');
const exportBtn=document.getElementById('exportBtn');
const importBtn=document.getElementById('importBtn');
const importFile=document.getElementById('importFile');
const clearBtn=document.getElementById('clearBtn'); // New button

init();

/* ---------- INITIALIZATION & EVENT HANDLERS ---------- */
function init(){
Â  fillYearSelect();
Â  renderTable();

Â  prevBtn.onclick=()=>changeYear(-1);
Â  nextBtn.onclick=()=>changeYear(1);
Â  yearSel.onchange=e=>{currentYear=+e.target.value;renderTable();};
Â  exportBtn.onclick=exportCSV;
Â  importBtn.onclick=()=>importFile.click();
Â  importFile.onchange=handleImport;
Â  clearBtn.onclick=clearYearData; // New handler
}

function fillYearSelect(){
Â  let base=new Date().getFullYear();
Â  for(let y=base-10;y<=base+10;y++){
Â  Â  const opt=document.createElement('option');
Â  Â  opt.value=y;
Â  Â  opt.textContent=y;
Â  Â  if(y===base) opt.selected=true;
Â  Â  yearSel.appendChild(opt);
Â  }
}
function changeYear(dir){
Â  let newYear=currentYear+dir;
Â  if(yearSel.querySelector(`option[value="${newYear}"]`)){
Â  Â  currentYear=newYear;
Â  Â  yearSel.value=newYear;
Â  Â  renderTable();
Â  }
}

/* ---------- TABLE RENDERING ---------- */
function renderTable(){
Â  tbody.innerHTML='';
Â  ROWS.forEach(r=>{
Â  Â  const tr=document.createElement('tr');
Â  Â  tr.dataset.rowId=r.id;
Â  Â  tr.className=r.type;

Â  Â  const label=document.createElement('td');
Â  Â  label.className='col-label';
Â  Â  label.textContent=r.name;
Â  Â  tr.appendChild(label);

Â  Â  MONTHS.forEach((m,mi)=>{
Â  Â  Â  const td=document.createElement('td');
Â  Â  Â  if(r.type==='item'){
Â  Â  Â  Â  const inp=document.createElement('input');
Â  Â  Â  Â  inp.type='number';
Â  Â  Â  Â  inp.step='0.01';
Â  Â  Â  Â  inp.inputMode='decimal'; 
Â  Â  Â  Â  const v=getVal(r.id,mi);
Â  Â  Â  Â  inp.value=v?v.toFixed(2):'';
Â  Â  Â  Â  inp.onblur=()=>cellChanged(r.id,mi,inp.value); 
Â  Â  Â  Â  td.appendChild(inp);
Â  Â  Â  }
Â  Â  Â  tr.appendChild(td);
Â  Â  });

Â  Â  const ytd=document.createElement('td');
Â  Â  ytd.className='yearTotal';
Â  Â  tr.appendChild(ytd);

Â  Â  tbody.appendChild(tr);
Â  });
Â  updateTotals();
}

/* ---------- DATA MANIPULATION & CALCULATION ---------- */
function getVal(id,mi){
Â  return db[currentYear]?.[id]?.[mi]||0;
}

function cellChanged(id,mi,val){
Â  let v=parseFloat(val);
Â  v = (isNaN(v) || v < 0) ? 0 : v;
Â  
Â  if(!db[currentYear]) db[currentYear]={};
Â  if(!db[currentYear][id]) db[currentYear][id]=Array(12).fill(0);
Â  db[currentYear][id][mi]=v;

Â  const input = tbody.querySelector(`tr[data-row-id="${id}"] td:nth-child(${mi + 2}) input`);
Â  if (input) input.value = v.toFixed(2);

Â  saveAll();
Â  updateTotals();
}

function updateTotals(){
Â  if(!db[currentYear]) db[currentYear]={};

Â  ROWS.forEach(r=>{
Â  Â  if(r.type==='total'){
Â  Â  Â  let arr=Array(12).fill(0);
Â  Â  Â  r.totalOf.forEach(id=>{
Â  Â  Â  Â  for(let i=0; i<12; i++){
Â  Â  Â  Â  Â  arr[i]+=getVal(id, i);
Â  Â  Â  Â  }
Â  Â  Â  });
Â  Â  Â  db[currentYear][r.id]=arr;
Â  Â  }
Â  });

Â  const netRow=ROWS.find(r=>r.type==='net');
Â  if(netRow){
Â  Â  const inc=db[currentYear][netRow.netOf[0]]||Array(12).fill(0);
Â  Â  const exp=db[currentYear][netRow.netOf[1]]||Array(12).fill(0);
Â  Â  db[currentYear][netRow.id]=inc.map((v,i)=>v-exp[i]);
Â  }

Â  ROWS.forEach(r=>{
Â  Â  if(['total','net'].includes(r.type)){
Â  Â  Â  const tr=tbody.querySelector(`tr[data-row-id="${r.id}"]`);
Â  Â  Â  if(!tr) return;
Â  Â  Â  const vals=db[currentYear][r.id]||Array(12).fill(0);
Â  Â  Â  
Â  Â  Â  vals.forEach((v,i)=>{
Â  Â  Â  Â  const td=tr.children[i+1];
Â  Â  Â  Â  td.textContent=FORMATTER.format(v); 
Â  Â  Â  Â  td.className = r.type + (r.type === 'net' ? (v >= 0 ? ' net-pos' : ' net-neg') : '');
Â  Â  Â  });
Â  Â  Â  
Â  Â  Â  const ytd=tr.querySelector('.yearTotal');
Â  Â  Â  const sum=vals.reduce((a,b)=>a+b,0);
Â  Â  Â  ytd.textContent=FORMATTER.format(sum);
Â  Â  Â  ytd.className='yearTotal' + (r.type === 'net' ? (sum >= 0 ? ' net-pos' : ' net-neg') : '');
Â  Â  }
Â  });
}

/* ---------- UTILITY FUNCTIONS ---------- */
function clearYearData(){
Â  if(confirm(`Are you sure you want to clear all data for the year ${currentYear}? This action cannot be undone.`)){
Â  Â  delete db[currentYear];
Â  Â  saveAll();
Â  Â  renderTable();
Â  Â  alert(`Data for ${currentYear} has been cleared.`);
Â  }
}

function exportCSV(){
Â  let csv='Category,'+MONTHS.join(',')+'\n';
Â  ROWS.filter(r => r.type === 'item').forEach(r=>{
Â  Â  let vals=db[currentYear]?.[r.id]||Array(12).fill(0); 
Â  Â  let row=[`"${r.name}"`,...vals.map(v=>parseFloat(v).toFixed(2))];
Â  Â  csv+=row.join(',')+'\n';
Â  });

Â  const blob=new Blob([csv],{type:'text/csv'});
Â  const a=document.createElement('a');
Â  a.href=URL.createObjectURL(blob);
Â  a.download=`budget_input_data_${currentYear}.csv`;
Â  a.click();
}

function handleImport(e){
Â  let file=e.target.files[0];
Â  if(!file) return alert('Please select a file.');

Â  const reader=new FileReader();
Â  reader.onload=ev=>{
Â  Â  const lines=ev.target.result.split('\n').filter(l=>l.trim());
Â  Â  if(lines.length < 2) return alert('CSV file is empty or invalid.');
Â  Â  
Â  Â  lines.shift(); 

Â  Â  const itemRows = ROWS.filter(r => r.type === 'item');

Â  Â  if(!db[currentYear]) db[currentYear]={}; 
Â  Â  
Â  Â  lines.forEach((ln,i)=>{
Â  Â  Â  let cols=ln.split(',').map(c => c.replace(/"/g, ''));
Â  Â  Â  
Â  Â  Â  if(cols.length < 13) return;
Â  Â  Â  
Â  Â  Â  const r=itemRows[i];
Â  Â  Â  
Â  Â  Â  if(!r || r.name.toLowerCase() !== cols[0].toLowerCase()) {
Â  Â  Â  Â  console.warn(`Skipping row ${cols[0]}: Name/position mismatch.`);
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  db[currentYear][r.id]=cols.slice(1,13).map(v=>Math.max(0,parseFloat(v)||0));
Â  Â  });
Â  Â  
Â  Â  saveAll();
Â  Â  renderTable();
Â  Â  importFile.value=''; 
Â  };
Â  reader.readAsText(file);
}

/* ---------- LOCAL STORAGE (Persistence) ---------- */
function saveAll(){
Â  try {
Â  Â  localStorage.setItem(STORAGE_KEY,JSON.stringify(db));
Â  } catch (e) {
Â  Â  console.error('LocalStorage save failed:', e);
Â  Â  alert('Warning: Data could not be saved to local storage.');
Â  }
}

function loadAll(){
Â  try {
Â  Â  return JSON.parse(localStorage.getItem(STORAGE_KEY)||'{}');
Â  } catch (e) {
Â  Â  console.warn('LocalStorage load failed. Starting with empty budget.');
Â  Â  return {};
Â  }
}
</script>

</body>
</html>
